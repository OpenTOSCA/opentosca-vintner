# Pruning Nodes (Combined)

{{ autogenerated_notice('yarn docs:generate:tests') }}

## Description

The following is a complex example using transient and unprunable nodes.
The variable service topology is structured as follows.

- A user application is hosted on a web server hosted on a virtual machine. 
- The virtual machine is hosted on a hypervisor.
- Furthermore, a monitoring agent is hosted on the virtual machine.

The variability-resolved service template only contains the hypervisor.

- The user application is not present.
- Thus, corresponding relations are also not present. 
- Thus, the web server and corresponding relations are not present. 
- At this moment, the virtual machine is hosting only the monitoring agent which is transient.
- Since the virtual machine only hosts a transient component, the virtual machine and the monitoring agent are not present.
- The hypervisor is present even though all incoming relations are not present since the hypervisor is unprunable.


## Variable Service Template

The variability of the following variable service template shall be resolved.

```yaml linenums="1"
tosca_definitions_version: tosca_variability_1_0
topology_template:
  node_templates:
    user_application:
      type: user_application
      conditions: false
      requirements:
        - host: web_server
    web_server:
      type: web_server
      requirements:
        - host: virtual_machine
    monitoring_agent:
      type: monitoring_agent
      transient: true
      requirements:
        - host: virtual_machine
    virtual_machine:
      type: virtual_machine
      requirements:
        - host: hypervisor
    hypervisor:
      type: hypervisor
      prunable: false
```



## Resolver Configuration

The following resolver configuration is used.

```yaml linenums="1"
enable_relation_pruning: true
enable_node_pruning: true

```

## Variability-Resolved Service Template

The following variability-resolved service templated is expected.

```yaml linenums="1"
tosca_definitions_version: tosca_simple_yaml_1_3
topology_template:
  node_templates:
    hypervisor:
      type: hypervisor
```


## Resolver Configuration

The following resolver configuration is used.

```yaml linenums="1"
enableRelationPruning: true
enableNodePruning: true
```
