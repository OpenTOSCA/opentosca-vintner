# Documentation

{{ linux_only_notice() }}

## MkDocs

The documentation is powered by [Material for MkDocs](https://squidfunk.github.io/mkdocs-material){target=_blank}.
Corresponding files are located in the `docs` directory.
Custom macros are implemented in `docs/macros.py` using [mkdocs-macros](https://mkdocs-macros-plugin.readthedocs.io){target=_blank}.

We expect that Python and [pandoc](https://pandoc.org){target=_blank} is already installed.
To install [pandoc](https://pandoc.org){target=_blank} on Ubuntu you might run

```shell linenums="1"
sudo apt-get install pandoc
```

With the following command you can install `mkdocs-material` along with its requirements globally on your system.

```shell linenums="1"
yarn docs:install
```

To start a local development server on [http://localhost:8000](http://localhost:8000){target=_blank}, run

```shell linenums="1"
yarn docs:serve
```

Once the server is running, run the following command to open the docs in your browser

```shell linenums="1"
yarn docs:open
```

## Autogenerated Markdown

Some Markdown files are autogenerated, e.g., [Dependencies](../dependencies.md){target=_blank} or [Interface](../interface.md){target=_blank}.
To warn the developer, include the following custom marco at the top of the template

```text linenums="1"
{% raw %}
{{ autogenerated_notice('yarn docs:generate:licenses') }}
{% endraw %}
```

This will render the following warning, if the docs are served using `yarn docs:serve`.

{{ autogenerated_notice('yarn docs:generate:licenses', True) }}

Behind the scenes, the following Markdown is injected.

```text linenums="1"
{{ autogenerated_notice('yarn docs:generate:licenses', True) }}
```


## Licenses

To generate a list of licenses for all (transitive) dependencies, run the following command

```shell linenums="1"
yarn docs:generate:licenses
```

The list includes information such as package name, version, license, etc. and is written to a CSV file.
At the same time, the [Dependencies](../dependencies.md){target=_blank} page is generated.
This command is also executed during the `release` workflow and, therefore, overwrites respective files.


## Interface

To generate the documentation for the CLI and REST API, run the following command.
This command is also executed during the `release` workflow and, therefore, overwrites respective files.

```shell linenums="1"
yarn docs:generate:interface
```

The documentation is build and published using GitHub Pages on pushes to the `main` branch.

## Casts

{{ linux_only_notice() }}

The docs contain recorded demos. Thereby, we use the following tools

- [asciinema](https://asciinema.org/){target=_blank} to record a terminal session
- [demo-magic](https://github.com/paxtonhare/demo-magic){target=_blank} to automate the terminal session
- [asciinema-player](https://github.com/asciinema/asciinema-player){target=_blank} embed casts in a standalone manner

Casts are not recorded during any workflow.
The following command can be used to record the `home` cast for the landing page

```shell linenums="1"
yarn docs:record:home
```

A cast can be embedded using the custom macro `asciinema_player` as follows inside a Markdown file.

```text linenums="1"
{% raw %}
{{ asciinema_player('getting-started') }}
{% endraw %}
```

This will embed the cast `docs/docs/assets/casts/getting-started.cast` inside the page as follows.

{{ asciinema_player('getting-started') }}

Behind the scenes, the following HTML is injected.

```text linenums="1"
{{ asciinema_player('getting-started') }}
```


## Validate Service Template

To validate a service template, run the following command.
This will install [puccini](https://github.com/tliron/puccini) in the background and execute its parser.
This only works on Linux or if WSL is installed.

```shell linenums="1"
yarn puccini:validate:single path/to/service-template.yaml
```

To validate all registered service templates, run the following command.

```shell linenums="1"
yarn puccini:check
```

## PlantUML

We use [PlantUML](http://plantuml.com) for visualizing UML diagrams.
Read [PlantUML Guide](https://plantuml.com/de/guide) for modeling instructions.

The following command plots all `.puml` files found in this repository using [PlantUML](http://plantuml.com).
This command is not executed in the pipeline since [mkdocs_build_plantuml](https://github.com/quantorconsulting/mkdocs_build_plantuml){target=_blank} to plot PUML when building mkdocs.

```shell linenums="1"
yarn docs:plot:puml
```

The following command generates PUML files for registered service templates.
This command is executed in the pipeline.

```shell linenums="1"
yarn docs:generate:puml
```

Note, for plotting SVGs we use the public PlantUML server https://www.plantuml.com/plantuml.
It is also possible to start a local PlantUML server using Docker.
Therefore, run the following command.

```shell linenums="1"
yarn puml:up 
```

However, you also need to configure the following environment variables in `docs/.env`.

```yaml linenums="1"
MKDOCS_PUML_SERVER=http://localhost:8080
MKDOCS_PUML_SERVER_SSL=true
```

To stop the local PlantUML server, run the following command.

```shell linenums="1"
yarn puml:down
```
