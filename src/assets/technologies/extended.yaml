###################################################
#
# WARNING: Do not edit! This file is autogenerated!
#
###################################################

tosca_definitions_version: tosca_simple_yaml_1_3

imports:
    - base.yaml

node_types:
    ###################################################
    #
    # GCP Provider
    #
    ###################################################

    gcp.provider:
        derived_from: root

        properties:
            env_platform:
                type: string
                default: gcp

            gcp_region:
                type: string

            gcp_service_account_file:
                type: string

            gcp_project:
                type: string

        capabilities:
            host:
                type: tosca.capabilities.Compute

        interfaces:
            Standard:
                operations:
                    create: exit 0
                    delete: exit 0

    ###################################################
    #
    # GCP Service
    #
    ###################################################

    gcp.service:
        derived_from: root
        metadata:
            vintner_abstract: 'true'

        properties:
            env_platform:
                type: string
                default: gcp

            gcp_service:
                type: string
                # Unfurl does not accept if there is a default only at the child
                default: 'must-be-overridden'

        capabilities:
            host:
                type: tosca.capabilities.Compute

        requirements:
            - host:
                  capability: tosca.capabilities.Compute
                  relationship: tosca.relationships.HostedOn

    gcp.cloudrun:
        derived_from: gcp.service
        properties:
            gcp_service:
                type: string
                default: 'run.googleapis.com'

    gcp.cloudsql:
        derived_from: gcp.service
        properties:
            gcp_service:
                type: string
                default: 'sqladmin.googleapis.com'

    gcp.appengine:
        derived_from: gcp.service
        properties:
            gcp_service:
                type: string
                default: 'appengine.googleapis.com'
        requirements:
            - build:
                  capability: tosca.capabilities.Root
                  relationship: tosca.relationships.DependsOn
            - reporting:
                  capability: tosca.capabilities.Root
                  relationship: tosca.relationships.DependsOn

    gcp.appenginereporting:
        derived_from: gcp.service
        properties:
            gcp_service:
                type: string
                default: 'appenginereporting.googleapis.com'

    gcp.cloudbuild:
        derived_from: gcp.service
        properties:
            gcp_service:
                type: string
                default: 'cloudbuild.googleapis.com'

    ###################################################
    #
    # Docker Engine
    #
    ###################################################

    docker.engine:
        derived_from: root

        properties:
            env_platform:
                type: string
                default: {eval: '.::.requirements::[.name=host]::.target::env_platform'}

        attributes:
            management_address:
                type: string
                default: {eval: '.::.requirements::[.name=host]::.target::management_address'}

        capabilities:
            host:
                type: tosca.capabilities.Compute
            endpoint:
                type: unfurl.capabilities.Endpoint.Ansible
                properties:
                    connection: ssh
                    host: {eval: '.parent::management_address'}

    ###################################################
    #
    # Kubernetes
    #
    ###################################################

    kubernetes:
        derived_from: root

        properties:
            env_platform:
                type: string
                default: kubernetes

            k8s_host:
                type: string

            k8s_ca_cert_file:
                type: string

            k8s_client_cert_file:
                type: string

            k8s_client_key_file:
                type: string

        capabilities:
            host:
                type: tosca.capabilities.Compute

        interfaces:
            Standard:
                operations:
                    create: exit 0
                    delete: exit 0

    ###################################################
    #
    # Openstack Provider
    #
    ###################################################

    openstack.provider:
        derived_from: root

        properties:
            env_platform:
                type: string
                default: openstack

            os_region_name:
                type: string

            os_auth_type:
                type: string

            os_auth_url:
                type: string

            os_identity_api_version:
                type: string

            os_interface:
                type: string

            os_application_credential_id:
                type: string

            os_application_credential_secret:
                type: string

        capabilities:
            host:
                type: tosca.capabilities.Compute

        interfaces:
            Standard:
                operations:
                    create: exit 0
                    delete: exit 0

    ###################################################
    #
    # Openstack Machine
    #
    ###################################################

    openstack.machine:
        derived_from: compute
        properties:
            env_platform:
                type: string
                default: openstack

            ports:
                type: list
                entry_schema:
                    type: integer

            machine:
                type: string

            flavor:
                type: string
                default: 'm1.medium'

            os_network:
                type: string

        attributes:
            management_address:
                type: string

            application_address:
                type: string
                default: {eval: '.::management_address'}

        capabilities:
            host:
                type: tosca.capabilities.Compute
            endpoint:
                type: unfurl.capabilities.Endpoint.Ansible
                properties:
                    connection: ssh
                    host: {eval: '.parent::management_address'}

    ###################################################
    #
    # MySQL DBMS
    #
    ###################################################

    mysql.dbms:
        derived_from: relational.dbms

        properties:
            dbms_name:
                type: string

            dbms_image:
                type: string
                default: mysql:5.6

            dbms_password:
                type: string

            dbms_ssl_mode:
                type: string
                default: None

        attributes:
            application_address:
                type: string

            application_port:
                type: integer

            management_address:
                type: string

            management_port:
                type: integer

        capabilities:
            host:
                type: tosca.capabilities.Compute

        requirements:
            - host:
                  capability: tosca.capabilities.Compute
                  relationship: tosca.relationships.HostedOn

    ###################################################
    #
    # MySQL Database
    #
    ###################################################

    mysql.database:
        derived_from: relational.database

        properties:
            database_name:
                type: string

            database_user:
                type: string

            database_password:
                type: string

        attributes:
            application_address:
                type: string
                default: {eval: '.::.requirements::[.name=host]::.target::application_address'}

            application_port:
                type: integer
                default: {eval: '.::.requirements::[.name=host]::.target::application_port'}

        capabilities:
            database:
                type: tosca.capabilities.Endpoint.Database

        requirements:
            - host:
                  capability: tosca.capabilities.Compute
                  relationship: tosca.relationships.HostedOn
