#!/usr/bin/bash
set -e

# Set working directory
cd "$(dirname "$0")"

# Set PATH
PATH="$(pwd)/node_modules/.bin:$PATH"

# Ensure that first argument exists
COMMAND="$1"
if [ -z "${COMMAND}" ]; then
  echo "First argument must be the command to execute"
  exit 1
fi

# Replace ":" with "/"
REPLACED="${COMMAND//://}"

# Run task.sh
TASK_SH=tasks/${REPLACED}/task.sh
if [ -f "${TASK_SH}" ]; then
  bash ${TASK_SH} "${@:2}"
  exit 0
fi

# Run task.js
TASK_JS=build-tasks/tasks/${REPLACED}/task.js
if [ -f "${TASK_JS}" ]; then
  node ${TASK_JS} "${@:2}"
  exit 0
fi

# Run task.ts
TASK_SH=tasks/${REPLACED}/task.ts
if [ -f "${TASK_TS}" ]; then
  ts-node -r tsconfig-paths/register ${TASK_TS} "${@:2}"
  exit 0
fi

# Run task.py
TASK_PY=tasks/${REPLACED}/task.py
if [ -f "${TASK_PY}" ]; then
  python ${TASK_PY} "${@:2}"
  exit 0
fi
