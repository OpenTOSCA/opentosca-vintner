tosca_definitions_version: tosca_variability_1_0
topology_template:
    variability:
        inputs:
            static:
                type: boolean
                default: false
        presets:
            static:
                inputs:
                    static: true
            elastic:
                inputs:
                    static: false
        expressions:
            is_static:
                equal:
                    - variability_input: static
                    - true
            is_elastic:
                equal:
                    - variability_input: static
                    - false
        options:
            optimization: false
        constraints:
            - implies:
                  - node.shop
                  - xor:
                        - relation.host@0.node.shop
                        - relation.host@1.node.shop
            - implies:
                  - node.os_monitor
                  - relation.host@0.node.os_monitor
            - implies:
                  - node.gcp_runtime
                  - relation.host@0.node.gcp_runtime
    node_templates:
        - shop:
              type:
                  - shop.component:
                        conditions:
                            - node_presence: shop
                              _generated: true
              requirements:
                  - host:
                        node: os_compute
                        conditions:
                            - and:
                                  - node_presence: shop
                                    _generated: true
                                  - node_presence: os_compute
                                    _generated: true
                              _generated: true
                  - host:
                        node: gcp_runtime
                        conditions:
                            - and:
                                  - node_presence: shop
                                    _generated: true
                                  - node_presence: gcp_runtime
                                    _generated: true
                              _generated: true
              conditions: []
        - os_monitor:
              type:
                  - os.monitor:
                        conditions:
                            - node_presence: os_monitor
                              _generated: true
              requirements:
                  - host:
                        node: os_compute
                        conditions:
                            - and:
                                  - node_presence: os_monitor
                                    _generated: true
                                  - node_presence: os_compute
                                    _generated: true
                              _generated: true
              conditions:
                  - host_presence: SELF
                    _generated: true
        - os_compute:
              type:
                  - os.compute:
                        conditions:
                            - node_presence: os_compute
                              _generated: true
              conditions:
                  - has_incoming_relation: os_compute
                    _generated: true
        - gcp_runtime:
              type:
                  - gcp.runtime:
                        conditions:
                            - node_presence: gcp_runtime
                              _generated: true
              requirements:
                  - host:
                        node: gcp_cloud
                        conditions:
                            - and:
                                  - node_presence: gcp_runtime
                                    _generated: true
                                  - node_presence: gcp_cloud
                                    _generated: true
                              _generated: true
              conditions:
                  - and:
                        - has_incoming_relation: gcp_runtime
                        - host_presence: SELF
                    _generated: true
        - gcp_cloud:
              type:
                  - gcp.cloud:
                        conditions:
                            - node_presence: gcp_cloud
                              _generated: true
              conditions:
                  - has_incoming_relation: gcp_cloud
                    _generated: true
