tosca_definitions_version: tosca_variability_1_0
topology_template:
  variability:
    inputs:
      static:
        type: boolean
        default: true
    presets:
      static:
        inputs:
          static: true
      elastic:
        inputs:
          static: false
    expressions:
      is_static:
        equal:
          - variability_input: static
          - true
      is_elastic:
        equal:
          - variability_input: static
          - false
    options:
      optimization: false
      unique: true
      checks: false
    constraints:
      - implies:
          - and:
              - node.shop
              - manual.relation.host@0.node.shop
          - relation.host@0.node.shop
      - implies:
          - and:
              - node.shop
              - manual.relation.host@1.node.shop
          - relation.host@1.node.shop
      - implies:
          - and:
              - node.shop
              - manual.relation.database@2.node.shop
          - relation.database@2.node.shop
      - implies:
          - and:
              - node.shop
              - manual.relation.database@3.node.shop
          - relation.database@3.node.shop
      - implies:
          - and:
              - node.os_database
              - manual.relation.host@0.node.os_database
          - relation.host@0.node.os_database
      - implies:
          - and:
              - node.os_dbms
              - manual.relation.host@0.node.os_dbms
          - relation.host@0.node.os_dbms
      - implies:
          - and:
              - node.os_monitor
              - manual.relation.host@0.node.os_monitor
          - relation.host@0.node.os_monitor
  node_templates:
    - shop:
        type:
          - shop.component:
              conditions:
                - node_presence: shop
                  _generated: true
        requirements:
          - host:
              node: os_kubernetes
              conditions:
                - and:
                    - node_presence: shop
                      _generated: true
                    - node_presence: os_kubernetes
                      _generated: true
                  _generated: true
                - false
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: shop
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
                - true
          - database:
              node: os_database
              conditions:
                - and:
                    - node_presence: shop
                      _generated: true
                    - node_presence: os_database
                      _generated: true
                  _generated: true
                - false
          - database:
              node: gcp_database
              conditions:
                - and:
                    - node_presence: shop
                      _generated: true
                    - node_presence: gcp_database
                      _generated: true
                  _generated: true
                - true
        conditions: []
    - gcp_runtime:
        type:
          - gcp.runtime:
              conditions:
                - node_presence: gcp_runtime
                  _generated: true
        conditions:
          - has_incoming_relation: gcp_runtime
            _generated: true
    - gcp_database:
        type:
          - gcp.database:
              conditions:
                - node_presence: gcp_database
                  _generated: true
        conditions:
          - has_incoming_relation: gcp_database
            _generated: true
    - os_database:
        type:
          - os.database:
              conditions:
                - node_presence: os_database
                  _generated: true
        requirements:
          - host:
              node: os_dbms
              conditions:
                - and:
                    - node_presence: os_database
                      _generated: true
                    - node_presence: os_dbms
                      _generated: true
                  _generated: true
                - true
        conditions:
          - and:
              - has_incoming_relation: os_database
              - host_presence: SELF
            _generated: true
    - os_dbms:
        type:
          - os.dbms:
              conditions:
                - node_presence: os_dbms
                  _generated: true
        requirements:
          - host:
              node: os_kubernetes
              conditions:
                - and:
                    - node_presence: os_dbms
                      _generated: true
                    - node_presence: os_kubernetes
                      _generated: true
                  _generated: true
                - true
        conditions:
          - and:
              - has_incoming_relation: os_dbms
              - host_presence: SELF
            _generated: true
    - os_monitor:
        type:
          - os.monitor:
              conditions:
                - node_presence: os_monitor
                  _generated: true
        requirements:
          - host:
              node: os_kubernetes
              conditions:
                - and:
                    - node_presence: os_monitor
                      _generated: true
                    - node_presence: os_kubernetes
                      _generated: true
                  _generated: true
                - true
        conditions:
          - host_presence: SELF
            _generated: true
    - os_kubernetes:
        type:
          - os.kubernetes:
              conditions:
                - node_presence: os_kubernetes
                  _generated: true
        conditions:
          - has_incoming_relation: os_kubernetes
            _generated: true
