tosca_definitions_version: tosca_variability_1_0_rc_3
imports:
  - file: lib/types.yaml
    conditions: []
topology_template:
  variability:
    expressions:
      is_docker:
        equal:
          - variability_input: env
          - DOCKER
      is_gcp:
        equal:
          - variability_input: env
          - GCP
      is_kubernetes:
        equal:
          - variability_input: env
          - KUBERNETES
      is_openstack:
        equal:
          - variability_input: env
          - OPENSTACK
    inputs:
      env:
        type: string
        default: DOCKER
      tier:
        type: string
        default: MEDIUM
    constraints:
      - amo:
          - property.flavor@0.node.virtual_machine
          - property.flavor@1.node.virtual_machine
      - implies:
          - node.frontend_service
          - xor:
              - relation.host@7.node.frontend_service
              - relation.host@8.node.frontend_service
              - relation.host@9.node.frontend_service
              - relation.host@10.node.frontend_service
      - implies:
          - node.checkout_service
          - xor:
              - relation.host@6.node.checkout_service
              - relation.host@7.node.checkout_service
              - relation.host@8.node.checkout_service
              - relation.host@9.node.checkout_service
      - implies:
          - node.email_service
          - xor:
              - relation.host@0.node.email_service
              - relation.host@1.node.email_service
              - relation.host@2.node.email_service
              - relation.host@3.node.email_service
      - implies:
          - node.payment_service
          - xor:
              - relation.host@0.node.payment_service
              - relation.host@1.node.payment_service
              - relation.host@2.node.payment_service
              - relation.host@3.node.payment_service
      - implies:
          - node.currency_service
          - xor:
              - relation.host@0.node.currency_service
              - relation.host@1.node.currency_service
              - relation.host@2.node.currency_service
              - relation.host@3.node.currency_service
      - implies:
          - node.shipping_service
          - xor:
              - relation.host@0.node.shipping_service
              - relation.host@1.node.shipping_service
              - relation.host@2.node.shipping_service
              - relation.host@3.node.shipping_service
      - implies:
          - node.cart_service
          - xor:
              - relation.host@1.node.cart_service
              - relation.host@2.node.cart_service
              - relation.host@3.node.cart_service
              - relation.host@4.node.cart_service
      - implies:
          - node.postgresql_database
          - relation.host@0.node.postgresql_database
      - implies:
          - node.postgresql_dbms
          - xor:
              - relation.host@0.node.postgresql_dbms
              - relation.host@1.node.postgresql_dbms
              - relation.host@2.node.postgresql_dbms
              - relation.host@3.node.postgresql_dbms
      - implies:
          - node.product_service
          - xor:
              - relation.host@0.node.product_service
              - relation.host@1.node.product_service
              - relation.host@2.node.product_service
              - relation.host@3.node.product_service
      - implies:
          - node.recommendation_service
          - xor:
              - relation.host@1.node.recommendation_service
              - relation.host@2.node.recommendation_service
              - relation.host@3.node.recommendation_service
              - relation.host@4.node.recommendation_service
      - implies:
          - node.advertisement_service
          - xor:
              - relation.host@0.node.advertisement_service
              - relation.host@1.node.advertisement_service
              - relation.host@2.node.advertisement_service
              - relation.host@3.node.advertisement_service
      - implies:
          - node.go_runtime
          - relation.host@0.node.go_runtime
      - implies:
          - node.csharp_runtime
          - relation.host@0.node.csharp_runtime
      - implies:
          - node.node_runtime
          - relation.host@0.node.node_runtime
      - implies:
          - node.python_runtime
          - relation.host@0.node.python_runtime
      - implies:
          - node.java_runtime
          - relation.host@0.node.java_runtime
      - implies:
          - node.virtual_machine
          - relation.host@0.node.virtual_machine
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.checkout@0.node.frontend_service
          - relation.checkout@0.node.frontend_service
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.currency@1.node.frontend_service
          - relation.currency@1.node.frontend_service
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.shipping@2.node.frontend_service
          - relation.shipping@2.node.frontend_service
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.cart@3.node.frontend_service
          - relation.cart@3.node.frontend_service
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.product@4.node.frontend_service
          - relation.product@4.node.frontend_service
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.recommendation@5.node.frontend_service
          - relation.recommendation@5.node.frontend_service
      - implies:
          - and:
              - node.frontend_service
              - manual.relation.advertisement@6.node.frontend_service
          - relation.advertisement@6.node.frontend_service
      - implies:
          - and:
              - node.checkout_service
              - manual.relation.email@0.node.checkout_service
          - relation.email@0.node.checkout_service
      - implies:
          - and:
              - node.checkout_service
              - manual.relation.payment@1.node.checkout_service
          - relation.payment@1.node.checkout_service
      - implies:
          - and:
              - node.checkout_service
              - manual.relation.currency@2.node.checkout_service
          - relation.currency@2.node.checkout_service
      - implies:
          - and:
              - node.checkout_service
              - manual.relation.shipping@3.node.checkout_service
          - relation.shipping@3.node.checkout_service
      - implies:
          - and:
              - node.checkout_service
              - manual.relation.cart@4.node.checkout_service
          - relation.cart@4.node.checkout_service
      - implies:
          - and:
              - node.checkout_service
              - manual.relation.product@5.node.checkout_service
          - relation.product@5.node.checkout_service
      - implies:
          - and:
              - node.cart_service
              - manual.relation.database@0.node.cart_service
          - relation.database@0.node.cart_service
      - implies:
          - and:
              - node.recommendation_service
              - manual.relation.product@0.node.recommendation_service
          - relation.product@0.node.recommendation_service
  node_templates:
    - frontend_service:
        type:
          - frontend.service:
              conditions:
                - node_presence: frontend_service
                  _generated: true
        requirements:
          - checkout:
              node: checkout_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: checkout_service
                      _generated: true
                  _generated: true
          - currency:
              node: currency_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: currency_service
                      _generated: true
                  _generated: true
          - shipping:
              node: shipping_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: shipping_service
                      _generated: true
                  _generated: true
          - cart:
              node: cart_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: cart_service
                      _generated: true
                  _generated: true
          - product:
              node: product_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: product_service
                      _generated: true
                  _generated: true
          - recommendation:
              node: recommendation_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: recommendation_service
                      _generated: true
                  _generated: true
          - advertisement:
              node: advertisement_service
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: advertisement_service
                      _generated: true
                  _generated: true
          - host:
              node: go_runtime
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: go_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: frontend_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions: []
    - checkout_service:
        type:
          - checkout.service:
              conditions:
                - node_presence: checkout_service
                  _generated: true
        requirements:
          - email:
              node: email_service
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: email_service
                      _generated: true
                  _generated: true
          - payment:
              node: payment_service
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: payment_service
                      _generated: true
                  _generated: true
          - currency:
              node: currency_service
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: currency_service
                      _generated: true
                  _generated: true
          - shipping:
              node: shipping_service
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: shipping_service
                      _generated: true
                  _generated: true
          - cart:
              node: cart_service
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: cart_service
                      _generated: true
                  _generated: true
          - product:
              node: product_service
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: product_service
                      _generated: true
                  _generated: true
          - host:
              node: go_runtime
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: go_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: checkout_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: checkout_service
              - host_presence: SELF
            _generated: true
    - email_service:
        type:
          - email.service:
              conditions:
                - node_presence: email_service
                  _generated: true
        requirements:
          - host:
              node: python_runtime
              conditions:
                - and:
                    - node_presence: email_service
                      _generated: true
                    - node_presence: python_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: email_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: email_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: email_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: email_service
              - host_presence: SELF
            _generated: true
    - payment_service:
        type:
          - payment.service:
              conditions:
                - node_presence: payment_service
                  _generated: true
        requirements:
          - host:
              node: node_runtime
              conditions:
                - and:
                    - node_presence: payment_service
                      _generated: true
                    - node_presence: node_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: payment_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: payment_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: payment_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: payment_service
              - host_presence: SELF
            _generated: true
    - currency_service:
        type:
          - currency.service:
              conditions:
                - node_presence: currency_service
                  _generated: true
        requirements:
          - host:
              node: node_runtime
              conditions:
                - and:
                    - node_presence: currency_service
                      _generated: true
                    - node_presence: node_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: currency_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: currency_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: currency_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: currency_service
              - host_presence: SELF
            _generated: true
    - shipping_service:
        type:
          - shipping.service:
              conditions:
                - node_presence: shipping_service
                  _generated: true
        requirements:
          - host:
              node: go_runtime
              conditions:
                - and:
                    - node_presence: shipping_service
                      _generated: true
                    - node_presence: go_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: shipping_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: shipping_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: shipping_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: shipping_service
              - host_presence: SELF
            _generated: true
    - cart_service:
        type:
          - cart.service:
              conditions:
                - node_presence: cart_service
                  _generated: true
        requirements:
          - database:
              node: postgresql_database
              conditions:
                - and:
                    - node_presence: cart_service
                      _generated: true
                    - node_presence: postgresql_database
                      _generated: true
                  _generated: true
          - host:
              node: csharp_runtime
              conditions:
                - and:
                    - node_presence: cart_service
                      _generated: true
                    - node_presence: csharp_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: cart_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: cart_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: cart_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: cart_service
              - host_presence: SELF
            _generated: true
    - postgresql_database:
        type:
          - postgresql.database:
              conditions:
                - node_presence: postgresql_database
                  _generated: true
        requirements:
          - host:
              node: postgresql_dbms
              conditions:
                - and:
                    - node_presence: postgresql_database
                      _generated: true
                    - node_presence: postgresql_dbms
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: postgresql_database
              - host_presence: SELF
            _generated: true
    - postgresql_dbms:
        type:
          - postgresql.dbms:
              conditions:
                - node_presence: postgresql_dbms
                  _generated: true
        requirements:
          - host:
              node: virtual_machine
              conditions:
                - and:
                    - node_presence: postgresql_dbms
                      _generated: true
                    - node_presence: virtual_machine
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: postgresql_dbms
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: postgresql_dbms
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: postgresql_dbms
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: postgresql_dbms
              - host_presence: SELF
            _generated: true
    - product_service:
        type:
          - product.service:
              conditions:
                - node_presence: product_service
                  _generated: true
        requirements:
          - host:
              node: go_runtime
              conditions:
                - and:
                    - node_presence: product_service
                      _generated: true
                    - node_presence: go_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: product_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: product_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: product_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: product_service
              - host_presence: SELF
            _generated: true
    - recommendation_service:
        type:
          - recommendation.service:
              conditions:
                - node_presence: recommendation_service
                  _generated: true
        requirements:
          - product:
              node: product_service
              conditions:
                - and:
                    - node_presence: recommendation_service
                      _generated: true
                    - node_presence: product_service
                      _generated: true
                  _generated: true
          - host:
              node: python_runtime
              conditions:
                - and:
                    - node_presence: recommendation_service
                      _generated: true
                    - node_presence: python_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: recommendation_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: recommendation_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: recommendation_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: recommendation_service
              - host_presence: SELF
            _generated: true
    - advertisement_service:
        type:
          - advertisement.service:
              conditions:
                - node_presence: advertisement_service
                  _generated: true
        requirements:
          - host:
              node: java_runtime
              conditions:
                - and:
                    - node_presence: advertisement_service
                      _generated: true
                    - node_presence: java_runtime
                      _generated: true
                  _generated: true
          - host:
              node: docker_runtime
              conditions:
                - and:
                    - node_presence: advertisement_service
                      _generated: true
                    - node_presence: docker_runtime
                      _generated: true
                  _generated: true
          - host:
              node: kubernetes_runtime
              conditions:
                - and:
                    - node_presence: advertisement_service
                      _generated: true
                    - node_presence: kubernetes_runtime
                      _generated: true
                  _generated: true
          - host:
              node: gcp_runtime
              conditions:
                - and:
                    - node_presence: advertisement_service
                      _generated: true
                    - node_presence: gcp_runtime
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: advertisement_service
              - host_presence: SELF
            _generated: true
    - go_runtime:
        type:
          - go.runtime:
              conditions:
                - node_presence: go_runtime
                  _generated: true
        requirements:
          - host:
              node: virtual_machine
              conditions:
                - and:
                    - node_presence: go_runtime
                      _generated: true
                    - node_presence: virtual_machine
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: go_runtime
              - host_presence: SELF
            _generated: true
    - csharp_runtime:
        type:
          - csharp.runtime:
              conditions:
                - node_presence: csharp_runtime
                  _generated: true
        requirements:
          - host:
              node: virtual_machine
              conditions:
                - and:
                    - node_presence: csharp_runtime
                      _generated: true
                    - node_presence: virtual_machine
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: csharp_runtime
              - host_presence: SELF
            _generated: true
    - node_runtime:
        type:
          - node.runtime:
              conditions:
                - node_presence: node_runtime
                  _generated: true
        requirements:
          - host:
              node: virtual_machine
              conditions:
                - and:
                    - node_presence: node_runtime
                      _generated: true
                    - node_presence: virtual_machine
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: node_runtime
              - host_presence: SELF
            _generated: true
    - python_runtime:
        type:
          - python.runtime:
              conditions:
                - node_presence: python_runtime
                  _generated: true
        requirements:
          - host:
              node: virtual_machine
              conditions:
                - and:
                    - node_presence: python_runtime
                      _generated: true
                    - node_presence: virtual_machine
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: python_runtime
              - host_presence: SELF
            _generated: true
    - java_runtime:
        type:
          - java.runtime:
              conditions:
                - node_presence: java_runtime
                  _generated: true
        requirements:
          - host:
              node: virtual_machine
              conditions:
                - and:
                    - node_presence: java_runtime
                      _generated: true
                    - node_presence: virtual_machine
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: java_runtime
              - host_presence: SELF
            _generated: true
    - virtual_machine:
        type:
          - virtual.machine:
              conditions:
                - node_presence: virtual_machine
                  _generated: true
        properties:
          - flavor:
              value: m1.medium
              conditions:
                - node_presence: virtual_machine
                  _generated: true
                - equal:
                    - variability_input: tier
                    - MEDIUM
          - flavor:
              value: m1.large
              conditions:
                - node_presence: virtual_machine
                  _generated: true
                - equal:
                    - variability_input: tier
                    - LARGE
        requirements:
          - host:
              node: openstack
              conditions:
                - and:
                    - node_presence: virtual_machine
                      _generated: true
                    - node_presence: openstack
                      _generated: true
                  _generated: true
        technology: []
        conditions:
          - and:
              - has_incoming_relation_naive: virtual_machine
              - host_presence: SELF
            _generated: true
    - openstack:
        type:
          - openstack.provider:
              conditions:
                - node_presence: openstack
                  _generated: true
        conditions:
          - has_incoming_relation_naive: openstack
            _generated: true
          - logic_expression: is_openstack
        technology: []
    - docker_runtime:
        type:
          - docker.engine:
              conditions:
                - node_presence: docker_runtime
                  _generated: true
        conditions:
          - has_incoming_relation_naive: docker_runtime
            _generated: true
          - logic_expression: is_docker
        technology: []
    - gcp_runtime:
        type:
          - gcp.provider:
              conditions:
                - node_presence: gcp_runtime
                  _generated: true
        conditions:
          - has_incoming_relation_naive: gcp_runtime
            _generated: true
          - logic_expression: is_gcp
        technology: []
    - kubernetes_runtime:
        type:
          - kubernetes:
              conditions:
                - node_presence: kubernetes_runtime
                  _generated: true
        conditions:
          - has_incoming_relation_naive: kubernetes_runtime
            _generated: true
          - logic_expression: is_kubernetes
        technology: []
