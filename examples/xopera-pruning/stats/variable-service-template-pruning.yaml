tosca_definitions_version: tosca_simple_yaml_1_3

description: |
    This non-executable topology template contains only elements that are required for the complexity evaluation.
    An executable topology template can be generated by resolving the variability of the executable variable deployment model.

    Elements are pruned.
    Thus, 8 conditions must be modeled.

topology_template:
    variability:
        inputs:
            mode:
                type: string
            large:
                type: boolean
                default: false

        presets:
            demo:
                inputs:
                    mode: demo

            cloud:
                inputs:
                    mode: cloud

            cloud-large:
                inputs:
                    mode: cloud
                    large: true

        expressions:
            is_demo: {equal: [{variability_input: mode}, demo]}
            is_cloud: {equal: [{variability_input: mode}, cloud]}

            is_large: {variability_input: large}
            is_medium: {not: {logic_expression: is_large}}
        options:
            mode: loose

        type_specific_conditions:
            node_types:
                scenario.monitor:
                    conditions: {host_presence: SELF}

    node_templates:
        shop:
            type: scenario.shop
            properties:
                - storage:
                      value: false
                      conditions: {logic_expression: is_demo}
                - storage:
                      value: true
                      conditions: {logic_expression: is_cloud}
            requirements:
                - host:
                      node: compute_localhost
                      conditions: {logic_expression: is_demo}

                - host:
                      node: compute_vm
                      conditions: {logic_expression: is_cloud}

                - database:
                      node: database
                      conditions: {logic_expression: is_cloud}

        database:
            type: scenario.database
            properties:
                name: db
            requirements:
                - host: compute_vm

        monitor:
            type: scenario.monitor
            properties:
                interval: 15 sec
            artifacts:
                binary:
                    type: tosca.artifacts.File
                    file: files/application-linux-arm64.xz
            requirements:
                - host: compute_vm

        compute_localhost:
            type: compute.localhost

        compute_vm:
            type: compute.vm
            properties:
                - tier:
                      value: medium
                      conditions: {logic_expression: is_medium}
                - tier:
                      value: large
                      conditions: {logic_expression: is_large}
            requirements:
                - host: compute_hypervisor

        compute_hypervisor:
            type: compute.hypervisor
