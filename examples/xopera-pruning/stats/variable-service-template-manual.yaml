tosca_definitions_version: tosca_simple_yaml_1_3

description: |
    This non-executable topology template contains only elements that are required for the complexity evaluation.
    An executable topology template can be generated by resolving the variability of the executable variable deployment model.

    Elements are not pruned.
    Thus, 18 conditions must be modeled.

topology_template:
    variability:
        inputs:
            mode:
                type: string
            public:
                type: boolean
                default: true

        presets:
            dev:
                inputs:
                    mode: dev

            prod:
                inputs:
                    mode: prod

            prod-private:
                inputs:
                    mode: prod
                    public: false

        expressions:
            is_dev: {equal: [{variability_input: mode}, dev]}
            is_prod: {equal: [{variability_input: mode}, prod]}

            is_public: {variability_input: public}
            is_not_public: {not: {logic_expression: is_public}}

        options:
            mode: strict

    node_templates:
        shop:
            type: scenario.shop
            properties:
                - storage:
                      value: false
                      conditions: {logic_expression: is_dev}
                - storage:
                      value: true
                      conditions: {logic_expression: is_prod}
            requirements:
                - host:
                      node: compute_localhost
                      conditions: {logic_expression: is_dev}

                - host:
                      node: compute_vm
                      conditions: {logic_expression: is_prod}

                - database:
                      node: database
                      conditions: {logic_expression: is_prod}

        database:
            type: scenario.database
            conditions: {logic_expression: is_prod}
            properties:
                - name:
                      value: db
                      conditions: {logic_expression: is_prod}
            requirements:
                - host:
                      node: compute_vm
                      conditions: {logic_expression: is_prod}

        monitor:
            type: scenario.monitor
            conditions: {logic_expression: is_prod}
            properties:
                - interval:
                      value: 15 sec
                      conditions: {logic_expression: is_prod}
            artifacts:
                binary:
                    type: tosca.artifacts.File
                    file: files/application-linux-arm64.xz
                    conditions: {logic_expression: is_prod}
            requirements:
                - host:
                      node: compute_vm
                      conditions: {logic_expression: is_prod}

        compute_localhost:
            type: compute.localhost
            conditions: {logic_expression: is_dev}

        compute_vm:
            type: compute.vm
            conditions: {logic_expression: is_prod}
            properties:
                - public:
                      value: true
                      conditions:
                          - {logic_expression: is_prod}
                          - {logic_expression: public}
                - public:
                      value: false
                      conditions:
                          - {logic_expression: is_prod}
                          - {logic_expression: is_not_public}
            requirements:
                - host:
                      node: compute_hypervisor
                      conditions: {logic_expression: is_prod}

        compute_hypervisor:
            type: compute.hypervisor
            conditions: {logic_expression: is_prod}
