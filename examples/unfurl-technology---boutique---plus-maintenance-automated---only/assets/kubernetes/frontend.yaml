---
apiVersion: apps/v1
kind: Deployment
metadata:
    name: frontend
    labels:
        app: frontend
spec:
    selector:
        matchLabels:
            app: frontend
    template:
        metadata:
            labels:
                app: frontend
        spec:
            containers:
                - name: server
                  image: gcr.io/google-samples/microservices-demo/frontend:v0.10.1
                  ports:
                      - containerPort: 8080
                  readinessProbe:
                      initialDelaySeconds: 10
                      httpGet:
                          path: '/_healthz'
                          port: 8080
                          httpHeaders:
                              - name: 'Cookie'
                                value: 'shop_session-id=x-readiness-probe'
                  livenessProbe:
                      initialDelaySeconds: 10
                      httpGet:
                          path: '/_healthz'
                          port: 8080
                          httpHeaders:
                              - name: 'Cookie'
                                value: 'shop_session-id=x-liveness-probe'
                  env:
                      - name: PORT
                        value: '8080'
                      - name: PRODUCT_CATALOG_SERVICE_ADDR
                        value: 'productcatalogservice:3550'
                      - name: CURRENCY_SERVICE_ADDR
                        value: 'currencyservice:7000'
                      - name: CART_SERVICE_ADDR
                        value: 'cartservice:7070'
                      - name: RECOMMENDATION_SERVICE_ADDR
                        value: 'recommendationservice:8080'
                      - name: SHIPPING_SERVICE_ADDR
                        value: 'shippingservice:50051'
                      - name: CHECKOUT_SERVICE_ADDR
                        value: 'checkoutservice:5050'
                      - name: AD_SERVICE_ADDR
                        value: 'adservice:9555'
                      # MUST BE SET!
                      - name: SHOPPING_ASSISTANT_SERVICE_ADDR
                        value: 'shoppingassistantservice:80'
                      - name: ENABLE_PROFILER
                        value: '0'
                      # - name: FRONTEND_MESSAGE
                      #   value: "Replace this with a message you want to display on all pages."
                      # As part of an optional Google Cloud demo, you can run an optional microservice called the "packaging service".
                      # - name: PACKAGING_SERVICE_URL
                      #   value: "" # This value would look like "http://123.123.123"

---
apiVersion: v1
kind: Service
metadata:
    name: frontend
    labels:
        app: frontend
spec:
    type: ClusterIP
    selector:
        app: frontend
    ports:
        - name: http
          port: 80
          targetPort: 8080

---
apiVersion: v1
kind: Service
metadata:
    name: frontend-external
    labels:
        app: frontend
spec:
    type: LoadBalancer
    selector:
        app: frontend
    ports:
        - name: http
          port: 80
          targetPort: 8080
