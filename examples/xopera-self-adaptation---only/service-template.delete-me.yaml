tosca_definitions_version: tosca_simple_yaml_1_3

imports:
    - lib/compute/types.yaml
    - lib/sensor/types.yaml

topology_template:
    inputs:
        vintner_host:
            type: string
            default: localhost

        vintner_port:
            type: string
            default: 3000

        instance:
            type: string

        compute_raspberry_user_name:
            type: string

        compute_raspberry_ssh_key_file:
            type: string

    node_templates:
        compute_raspberry:
            type: compute.raspberry
            properties:
                ssh_user: {get_input: compute_raspberry_user_name}
                ssh_key_file: {get_input: compute_raspberry_ssh_key_file}
            attributes:
                private_address: 192.168.178.45
                public_address: 192.168.178.45

        sensor_compute_raspberry:
            type: sensor.compute
            properties:
                vintner_host: {get_input: vintner_host}
                vintner_port: {get_input: vintner_port}
                instance: {get_input: instance}
                template: compute_raspberry
                ssh_user: {get_input: compute_raspberry_user_name}
                ssh_key_file: {get_input: compute_raspberry_ssh_key_file}
            requirements:
                - host: compute_raspberry

        sensor_weekday:
            type: sensor.weekday
            properties:
                vintner_host: {get_input: vintner_host}
                vintner_port: {get_input: vintner_port}
                instance: {get_input: instance}
            requirements:
                - host: compute_raspberry
