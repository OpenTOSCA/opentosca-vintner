tosca_definitions_version: tosca_simple_yaml_1_3

imports:
- repository: unfurl
  file: tosca_plugins/artifacts.yaml

- file: lib/node_app.yaml
- file: lib/node_runtime.yaml
- file: lib/sqlite.yaml
- file: lib/node_exporter.yaml
- file: lib/os_vm.yaml

- file: lib/gcp_app.yaml
- file: lib/gcp_database.yaml
- file: lib/gcp_dbms.yaml

topology_template:
  inputs:
    language: 
      type: string
      default: EN

    analytical: 
      type: boolean
      default: true

    db_password: 
      type: string
      default: password

    ssh_user:
      type: string
      default: ubuntu

    ssh_key_file:
      type: string
      default: /home/stoetzms/.ssh/bw-cloud--laptop-default

    gcp_credentials: 
      type: string
      default: /home/stoetzms/opera/stoetzms-387808-2ec1cf865c76.json

    gcp_project:
      type: string
      default: "stoetzms-387808"

    gcp_region: 
      type: string
      default: "europe-west3"

    os_region_name:
      type: string
      default: Mannheim

    os_auth_type:
      type: string
      default: v3applicationcredential

    os_auth_url:
      type: string
      default: https://idm02.bw-cloud.org:5000/v3

    os_identity_api_version:
      type: string
      default: "3"

    os_interface:
      type: string
      default: public

    os_application_credential_id:
      type: string
      default: a2d06e16e24a4e739b101e1b8dc75dff

    os_application_credential_secret:
      type: string
      default: GUf5byNyo57yz7eSAx-aqFH1QmLRwi2mkEZRVanAXV0csPd__WMR9kf-Dy-SziWarf45llnRv-ud1cZE2WY-oA

  node_templates:
    gcp_app:
      type: gcp_app
      properties:
        application_name: shop
      requirements:
      - database: gcp_database
      artifacts:
        artifact: files/application.enterprise.zip

    gcp_database:
      type: gcp_database
      properties:
        database_name: shop
      requirements: 
      - host: gcp_dbms

    gcp_dbms:
      type: gcp_dbms
      properties:
        instance_name: shop
        root_password: {get_input: db_password}

    app: 
      type: node_app
      properties:
        application_name: shop
      requirements:
      - host: runtime
      - database: sqlite
      artifacts:
        artifact: files/application.community.tar.gz

    runtime:
      type: node_runtime
      requirements:
      - host: vm

    sqlite:
      type: sqlite
      properties:
        database_name: shop
      requirements: 
      - host: vm

    monitor: 
      type: node_exporter
      requirements:
      - host: vm

    vm:
      type: os_vm
      properties:
        port_one: 3000
        port_two: 9100
        machine_name: shop